<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ª± √°n | SAOVN - H√†nh ƒê·ªông V√¨ Vi·ªát Nam</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        /* T·ªêI ∆ØU GIAO DI·ªÜN T·ªêI CH·ª¶ ƒê·∫†O */
        body { background-color: #0b0f19; color: #fff; }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
        }

        .nav-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
            margin-right: 20px;
        }

        /* KHUNG TH√îNG TIN TH√ÄNH VI√äN */
        .user-profile {
            display: none;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px 15px;
            border-radius: 30px;
            border: 1px solid #30363d;
        }

        .user-info-text {
            font-size: 0.85rem;
            color: #e6edf3;
        }

		.user-name {
			font-weight: 700;
			color: #00d2ff; /* M√†u xanh ƒë·∫∑c tr∆∞ng c·ªßa SAOVN */
			text-decoration: none;
			transition: 0.3s;
		}

		.user-name:hover {
			text-decoration: underline;
			color: #ffffff; /* Khi di chu·ªôt v√†o th√¨ hi·ªán m√†u tr·∫Øng cho n·ªïi b·∫≠t */
		}

        .btn-logout {
            background: transparent;
            border: 1px solid #ff3e3e;
            color: #ff3e3e;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: 0.3s;
        }

        .btn-logout:hover {
            background: #ff3e3e;
            color: #fff;
        }

        /* PROJECT STYLES */
        .project-card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden; }
        .project-card .card-content h3 { color: #fff; }
        .project-card .card-content p {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: #8b949e;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .card-img img { object-fit: cover; width: 100%; height: 180px; }

        .main-content-wrapper {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .sidebar { position: sticky; top: 100px; height: fit-content; }
        
        .sidebar-widget {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .widget-title {
            color: #ff3e3e; 
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 20px;
            border-left: 4px solid #ff3e3e;
            padding-left: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .category-list { display: flex; flex-direction: column; gap: 10px; }
        .filter-btn {
            background: transparent;
            color: #8b949e;
            border: 1px solid #30363d;
            padding: 10px 15px;
            text-align: left;
            cursor: pointer;
            transition: 0.3s;
            border-radius: 4px;
        }
        .filter-btn.active, .filter-btn:hover {
            background: #ff3e3e;
            color: #fff;
            border-color: #ff3e3e;
        }

        .discussion-wrapper {
            height: 300px; 
            overflow: hidden;
            position: relative;
        }

        .discussion-list {
            display: flex;
            flex-direction: column;
            position: absolute;
            width: 100%;
            top: 0;
        }

        .discussion-item {
            display: block;
            padding: 12px 0;
            border-bottom: 1px solid #30363d;
            text-decoration: none;
            height: 75px; 
        }

        .discussion-item h4 {
            color: #e6edf3;
            font-size: 0.9rem;
            margin: 0 0 5px 0;
            line-height: 1.3;
            transition: color 0.2s;
        }

        .discussion-item:hover h4 { color: #ff3e3e; }

        .disc-meta {
            font-size: 0.75rem;
            color: #8b949e;
            display: flex;
            justify-content: space-between;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #ff3e3e;
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 5px #ff3e3e;
            animation: blink 1.5s infinite;
        }

        @keyframes blink { 50% { opacity: 0.3; } }

        @media (max-width: 992px) {
            .main-content-wrapper { grid-template-columns: 1fr; }
            .sidebar { position: static; }
            .nav-container { margin-right: 0; gap: 10px; }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="logo-wrapper">
            <span class="logo-text">SAOVN</span>
            <span class="logo-slogan">Special Actions Organization for Vietnam</span>
        </a>
        
        <div class="menu-toggle" id="mobile-menu">
            <span class="bar"></span><span class="bar"></span><span class="bar"></span>
        </div>

        <nav class="nav-container">
            <a href="index.html" class="nav-link">Trang ch·ªß</a>
            <a href="ve-saovn.html" class="nav-link">V·ªÅ SAOVN</a>
            <a href="du-an.html" class="nav-link active">D·ª± √°n</a>
            <a href="quy-tac.html" class="nav-link">Quy t·∫Øc</a>
            <a href="register.html" class="nav-link" id="nav-register">ƒêƒÉng k√Ω</a>
            <button class="btn-login" id="nav-login-btn" onclick="window.location.href='login.html'">ƒêƒÉng nh·∫≠p</button>
            
            <div class="user-profile" id="user-profile-box">
                <div class="user-info-text">
                    Ch√†o, <a href="dashboard.html" class="user-name" id="display-user-link">
                        <span id="display-user-name">ƒêang t·∫£i...</span>
                    </a>
                </div>
                <button class="btn-logout" id="auth-logout-btn">ƒêƒÉng xu·∫•t</button>
            </div>
        </nav>
    </header>

    <section class="about-hero-pro">
        <div class="container">
            <span class="sub-title" data-aos="fade-up">Kho l∆∞u tr·ªØ h√†nh ƒë·ªông</span>
            <h1 data-aos="fade-up" data-aos-delay="200">D·ª∞ √ÅN <span class="highlight">CHI·∫æN L∆Ø·ª¢C</span></h1>
        </div>
    </section>

    <div class="container">
        <div class="main-content-wrapper">
            <main class="project-section">
                <div class="project-grid" id="project-container">
                    <div class="loading-placeholder">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ h·ªá th·ªëng...</div>
                </div>
            </main>

            <aside class="sidebar">
                <div class="sidebar-widget" data-aos="fade-left">
                    <div class="widget-title">DANH M·ª§C D·ª∞ √ÅN</div>
                    <div class="category-list" id="filter-container">
                        <button class="filter-btn active" data-filter="all">T·∫•t c·∫£ d·ª± √°n</button>
                    </div>
                </div>

                <div class="sidebar-widget" data-aos="fade-left" data-aos-delay="200">
                    <div class="widget-title">
                        M·ªöI C·∫¨P NH·∫¨T
                        <span class="live-dot"></span>
                    </div>
                    <div class="discussion-wrapper">
                        <div class="discussion-list" id="discussion-container">
                            <div class="loading-placeholder">...</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <footer>
        <div class="container footer-grid" data-aos="fade-up">
            <div class="footer-brand">
                <h3>SAOVN</h3>
                <p>Special Actions Organization for Vietnam</p>
                <p class="footer-slogan">S√°ng t·∫°o kh√¥ng gi·ªõi h·∫°n - N√¢ng t·∫ßm v·ªã th·∫ø Vi·ªát.</p>
            </div>

            <div class="footer-contact">
                <h4>Li√™n H·ªá</h4>
                <p>üìç ƒê·ªãa ch·ªâ: Qu·∫≠n 1, TP. H·ªì Ch√≠ Minh, Vi·ªát Nam</p>
                <p>üìû ƒêi·ªán tho·∫°i: 090 xxx xxxx</p>
                <p>‚úâÔ∏è Email: contact@saovn.org</p>
            </div>

            <div class="footer-socials">
                <h4>K·∫øt N·ªëi</h4>
                <div class="social-icons">
                    <a href="#" class="social-link">TikTok</a>
                    <a href="#" class="social-link">YouTube</a>
                    <a href="#" class="social-link">Discord</a>
                    <a href="#" class="social-link">Facebook</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p class="copyright">&copy; 2026 SAOVN. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, limit, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBa3zOMwQr-KO77c5SsXEar8ycoRkmFbLk",
            authDomain: "saovn-project.firebaseapp.com",
            projectId: "saovn-project",
            storageBucket: "saovn-project.firebasestorage.app",
            messagingSenderId: "194928117396",
            appId: "1:194928117396:web:642612a60105add5639681",
            measurementId: "G-L7Y106VT85"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- H·ªÜ TH·ªêNG KI·ªÇM TRA ƒêƒÇNG NH·∫¨P (ƒê√É C·∫¨P NH·∫¨T) ---
        const userProfileBox = document.getElementById('user-profile-box');
        const loginBtn = document.getElementById('nav-login-btn');
        const registerLink = document.getElementById('nav-register');
        const displayUserName = document.getElementById('display-user-name');
        const logoutBtn = document.getElementById('auth-logout-btn');

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userProfileBox.style.display = 'flex';
                loginBtn.style.display = 'none';
                registerLink.style.display = 'none';

                try {
                    // L·∫•y fullName t·ª´ collection 'users' d·ª±a tr√™n UID
                    const userDocRef = doc(db, "users", user.uid);
                    const userDocSnap = await getDoc(userDocRef);

                    if (userDocSnap.exists() && userDocSnap.data().fullName) {
                        displayUserName.innerText = userDocSnap.data().fullName;
                    } else {
                        // Fallback n·∫øu kh√¥ng c√≥ fullName
                        displayUserName.innerText = user.displayName || user.email.split('@')[0];
                    }
                } catch (error) {
                    console.error("L·ªói l·∫•y th√¥ng tin ng∆∞·ªùi d√πng:", error);
                    displayUserName.innerText = user.email.split('@')[0];
                }
            } else {
                userProfileBox.style.display = 'none';
                loginBtn.style.display = 'block';
                registerLink.style.display = 'block';
            }
        });

        logoutBtn.onclick = () => {
            signOut(auth).then(() => {
                window.location.reload();
            });
        };

        // --- T·∫¢I DANH M·ª§C SIDEBAR ---
        onSnapshot(collection(db, "categories"), (snap) => {
            const filterContainer = document.getElementById('filter-container');
            filterContainer.innerHTML = '<button class="filter-btn active" data-filter="all">T·∫•t c·∫£ d·ª± √°n</button>';
            snap.forEach(doc => {
                const catName = doc.data().name;
                filterContainer.innerHTML += `<button class="filter-btn" data-filter="${catName}">${catName}</button>`;
            });
            attachFilterEvents();
        });

        // --- T·∫¢I B·∫¢NG TH·∫¢O LU·∫¨N SIDEBAR ---
        const discussionContainer = document.getElementById('discussion-container');
        const qHot = query(collection(db, "projects"), orderBy("lastCommentAt", "desc"), limit(8));
        let scrollInterval;

        onSnapshot(qHot, (snap) => {
            let html = "";
            if (snap.empty) {
                discussionContainer.innerHTML = "<div class='discussion-item'>Kh√¥ng c√≥ d·ªØ li·ªáu.</div>";
                return;
            }
            snap.forEach(doc => {
                const p = doc.data();
                const timeStr = p.lastCommentAt ? 
                    new Date(p.lastCommentAt.seconds * 1000).toLocaleString('vi-VN', {
                        hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit'
                    }) : 'M·ªõi';
                html += `
                    <a href="chi-tiet-du-an.html?id=${doc.id}" class="discussion-item">
                        <h4>${p.title}</h4>
                        <div class="disc-meta">
                            <span>#${p.category}</span>
                            <span>${timeStr}</span>
                        </div>
                    </a>
                `;
            });
            discussionContainer.innerHTML = html + html; 
            startScrolling();
        });

        function startScrolling() {
            if (scrollInterval) clearInterval(scrollInterval);
            let offset = 0;
            const itemHeight = 75; 
            const totalItems = discussionContainer.children.length / 2;

            scrollInterval = setInterval(() => {
                offset++;
                discussionContainer.style.transition = 'top 0.6s ease-in-out';
                discussionContainer.style.top = `-${offset * itemHeight}px`;
                if (offset >= totalItems) {
                    setTimeout(() => {
                        discussionContainer.style.transition = 'none';
                        offset = 0;
                        discussionContainer.style.top = '0px';
                    }, 600);
                }
            }, 3000);
        }

        // --- T·∫¢I GRID D·ª∞ √ÅN ---
        const projectContainer = document.getElementById('project-container');
        const q = query(collection(db, "projects"), orderBy("createdAt", "desc"));

        onSnapshot(q, (snap) => {
            projectContainer.innerHTML = "";
            snap.forEach(doc => {
                const p = doc.data();
                const cleanText = p.content ? p.content.replace(/<[^>]*>/g, '') : "ƒêang c·∫≠p nh·∫≠t...";
                projectContainer.innerHTML += `
                    <div class="project-card" data-category="${p.category}" data-aos="fade-up">
                        <div class="card-img">
                            <img src="${p.thumbnail || 'https://via.placeholder.com/600x400'}" alt="${p.title}">
                        </div>
                        <div class="card-content">
                            <span class="card-tag">${p.category}</span>
                            <h3>${p.title}</h3>
                            <p>${cleanText}</p>
                            <div class="card-meta">
                                <span>üìÖ ${p.createdAt ? new Date(p.createdAt.seconds * 1000).toLocaleDateString('vi-VN') : 'G·∫ßn ƒë√¢y'}</span>
                            </div>
                            <a href="chi-tiet-du-an.html?id=${doc.id}" class="btn-card">Xem chi ti·∫øt</a>
                        </div>
                    </div>
                `;
            });
            AOS.refresh();
        });

        function attachFilterEvents() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.onclick = () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const val = btn.getAttribute('data-filter');
                    document.querySelectorAll('.project-card').forEach(card => {
                        card.style.display = (val === 'all' || card.getAttribute('data-category') === val) ? 'block' : 'none';
                    });
                };
            });
        }

        document.querySelector('#mobile-menu').onclick = function() {
            this.classList.toggle('is-active');
            document.querySelector('.nav-container').classList.toggle('active');
        };

        AOS.init({ duration: 800, once: true });
    </script>
</body>
</html>